function updateTable(symbol, origin, price) {
  const key = `${origin}_${symbol}`;
  const now = Date.now();

  if (!priceHistory[key]) {
    priceHistory[key] = [];
  }
  priceHistory[key].push({ time: now, price });
  priceHistory[key] = priceHistory[key].filter(p => now - p.time <= 15 * 60000);

  const rowId = `row-${key}`;
  let row = document.getElementById(rowId);
  const isNew = !row;

  if (isNew) {
    row = document.createElement("tr");
    row.id = rowId;
    row.innerHTML = `
      <td>${symbol}</td>
      <td>${origin}</td>
      <td class="price"></td>
      <td class="change-1"></td>
      <td class="change-3"></td>
      <td class="change-5"></td>
      <td class="change-15"></td>
      <td><a href="${origin === 'Binance' ? `https://www.binance.com/en/trade/${symbol}` : `https://www.mexc.com/exchange/${symbol}`}" target="_blank">Ver</a></td>
    `;
    table.appendChild(row);
  }
  row.querySelector(".price").textContent = price.toFixed(6);

  let hasPumpDump = false;

  if (!window.lastLoggedDiffs) {
    window.lastLoggedDiffs = {};
  }

  intervals.forEach(min => {
    const past = priceHistory[key].reduce((oldest, p) => {
      return now - p.time >= min * 60000 && (!oldest || p.time < oldest.time) ? p : oldest;
    }, null);

    const cell = row.querySelector(`.change-${min}`);
    if (past) {
      const diff = ((price - past.price) / past.price) * 100;
      cell.textContent = `${diff > 0 ? "+" : ""}${diff.toFixed(2)}%`;
      const classType = diff > 2 ? "pump" : diff < -2 ? "dump" : "";
      cell.className = `change-${min} ${classType}`;

      const logKey = `${key}_${min}`;
      const lastLogged = window.lastLoggedDiffs[logKey] || 0;

      if (Math.abs(diff) > 2 && Math.abs(diff - lastLogged) >= 1) {
        hasPumpDump = true;
        window.lastLoggedDiffs[logKey] = diff;
        playSingleBeep(symbol);
        logSignal(symbol, origin, diff, min);
      }
    } else {
      cell.textContent = "...";
      cell.className = `change-${min}`;
    }
  });

  if (hasPumpDump && table.firstChild !== row) {
    table.insertBefore(row, table.firstChild);
  }
}
